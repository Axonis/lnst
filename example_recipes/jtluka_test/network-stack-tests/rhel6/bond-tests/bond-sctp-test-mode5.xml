<nettestrecipe>

    <machines>
        <machine id="1">
            <netmachineconfig source="../rhel62-guest1.xml"/>
            <netconfig>
                <netdevice id="1" phys_id="1" type="eth"/>
                <netdevice id="2" phys_id="2" type="eth"/>
                <netdevice id="3" type="bond">
                    <options>
                        <option name="mode" value="5" />
                        <option name="miimon" value="100" />
                    </options>
                    <slaves>
                        <slave id="1"/>
                        <slave id="2"/>
                    </slaves>
                    <addresses>
                        <address value="192.168.100.2/24" />
                    </addresses>
                </netdevice>
            </netconfig>
        </machine>

        <machine id="2">
            <netmachineconfig source="../rhel62-guest2.xml"/>
            <netconfig>
                <netdevice id="1" phys_id="1" type="eth"/>
                <netdevice id="2" phys_id="2" type="eth"/>
                <netdevice id="3" type="bond">
                    <options>
                        <option name="mode" value="5" />
                        <option name="miimon" value="100" />
                    </options>
                    <slaves>
                        <slave id="1"/>
                        <slave id="2"/>
                    </slaves>
                    <addresses>
                        <address value="192.168.100.3/24" />
                    </addresses>
                </netdevice>
            </netconfig>
        </machine>
    </machines>


    <command_sequence>

<!-- just a ping check ... -->

        <command machine_id="1" type="test" value="IcmpPing">
            <options>
                <option type="recipe_eval" name="addr" value="['machines'][2]['netconfig'][3]['addresses'][0]" />
                <option name="count" value="3"/>
            </options>
        </command>

<!-- start basic SCTP stream tests ... -->

        <command machine_id="1" type="exec" value="sctp_test -H 192.168.100.2 -P 5679 -l" bg_id="1" dont_stop="true" />
        <command machine_id="2" type="exec" value="sctp_test -H 192.168.100.3 -P 1235 -h 192.168.100.2 -p 5679 -s -x 50" />
        <command machine_id="2" type="exec" value="sctp_test -H 192.168.100.3 -P 1235 -h 192.168.100.2 -p 5679 -s -x 50 -c 1" />
        <command machine_id="2" type="exec" value="sctp_test -H 192.168.100.3 -P 1235 -h 192.168.100.2 -p 5679 -s -x 50 -c 2" />
        <command machine_id="2" type="exec" value="sctp_test -H 192.168.100.3 -P 1235 -h 192.168.100.2 -p 5679 -s -x 50 -c 3" />
        <command machine_id="2" type="exec" value="sctp_test -H 192.168.100.3 -P 1235 -h 192.168.100.2 -p 5679 -s -x 50 -c 4" />
        <command machine_id="2" type="exec" value="sctp_test -H 192.168.100.3 -P 1235 -h 192.168.100.2 -p 5679 -s -x 50 -c 5" />
        <command machine_id="2" type="exec" value="sctp_test -H 192.168.100.3 -P 1235 -h 192.168.100.2 -p 5679 -s -x 50 -c 6" />

        <command type="exec" value="sleep 3" />

        <command machine_id="1" type="kill" value="1" />
    </command_sequence>

</nettestrecipe>
