<nettestrecipe>

    <machines>
        <machine id="1">
            <netmachineconfig source="../rhel58-guest1.xml"/>
            <netconfig>
                <netdevice id="1" phys_id="1" type="eth"/>
                <netdevice id="2" phys_id="2" type="eth"/>
                <netdevice id="3" type="bond">
                    <options>
                        <option name="mode" value="1" />
                        <option name="miimon" value="100" />
                    </options>
                    <slaves>
                        <slave id="1" />
                        <slave id="2" />
                    </slaves>
                </netdevice>

                <netdevice id="4" type="vlan">
                    <options>
                        <option name="vlan_tci" value="100" />
                    </options>
                    <slaves>
                        <slave id="3"/>
                    </slaves>
                    <addresses>
                        <address value="192.168.100.2/24" />
                    </addresses>
                </netdevice>
            </netconfig>
        </machine>

        <machine id="2">
            <netmachineconfig source="../rhel58-guest2.xml"/>
            <netconfig>
                <netdevice id="1" phys_id="1" type="eth"/>
                <netdevice id="2" type="vlan">
                    <options>
                        <option name="vlan_tci" value="100" />
                    </options>
                    <slaves>
                        <slave id="1" />
                    </slaves>
                    <addresses>
                        <address value="192.168.100.3/24" />
                    </addresses>
                </netdevice>
            </netconfig>
        </machine>
    </machines>


    <command_sequence>

<!-- do a simple pktgen traffic ... -->
        <command machine_id="1" type="test" value="PktCounter" bg_id="1">
            <options>
                <option name="input_netdev_name" type="recipe_eval" value="['machines'][1]['netconfig'][4]['name']"/>
                <option name="proto" value="udp"/>
                <option name="dport" value="9"/>
            </options>
        </command>

        <command machine_id="2" type="test" value="PktgenTx" timeout="40">
            <options>
                <option name="addr" type="recipe_eval" value="['machines'][1]['netconfig'][4]['addresses'][0]"/>
                <option name="hwaddr" type="recipe_eval" value="['machines'][1]['netconfig'][1]['hwaddr']"/>
                <option name="netdev_name" type="recipe_eval" value="['machines'][2]['netconfig'][2]['name']"/>
            </options>
        </command>

        <command machine_id="1" type="intr" value="1"/>

    </command_sequence>

</nettestrecipe>
