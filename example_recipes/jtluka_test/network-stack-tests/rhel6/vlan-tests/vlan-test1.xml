<nettestrecipe>

    <machines>
        <machine id="1">
            <netmachineconfig source="rhel62-guest1.xml"/>
            <netconfig>
                <netdevice id="1" phys_id="1" type="eth"/>
                <netdevice id="2" phys_id="2" type="eth"/>
                <netdevice id="3" type="vlan">
                    <options>
                        <option name="vlan_tci" value="100" />
                    </options>
                    <slaves>
                        <slave id="1"/>
                    </slaves>
                    <addresses>
                        <address value="192.168.100.2/24" />
                    </addresses>
                </netdevice>
            </netconfig>
        </machine>

        <machine id="2">
            <netmachineconfig source="rhel62-guest2.xml"/>
            <netconfig>
                <netdevice id="1" phys_id="1" type="eth"/>
                <netdevice id="2" phys_id="2" type="eth"/>
                <netdevice id="3" type="vlan">
                    <options>
                        <option name="vlan_tci" value="100" />
                    </options>
                    <slaves>
                        <slave id="1"/>
                    </slaves>
                    <addresses>
                        <address value="192.168.100.3/24" />
                    </addresses>
                </netdevice>
            </netconfig>
        </machine>
    </machines>


    <command_sequence>

<!-- just a ping check ... -->

        <command machine_id="1" type="test" value="IcmpPing">
            <options>
                <option type="recipe_eval" name="addr" value="['machines'][2]['netconfig'][3]['addresses'][0]" />
                <option name="count" value="3"/>
            </options>
        </command>

<!-- start basic TCP/UDP stream tests ... -->

        <command machine_id="2" type="exec" value="nc -l 10000" bg_id="1" />
        <command machine_id="1" type="test" value="NetCat">
            <options>
                <option name="port" value="10000" />
                <option name="duration" value="600" />
                <option name="addr" type="recipe_eval" value="['machines'][2]['netconfig'][3]['addresses'][0]" />
            </options>
        </command>
        <command type="kill" machine_id="2" value="1" />

        <command machine_id="2" type="exec" value="nc -u -l 10000" bg_id="2" />
        <command machine_id="1" type="test" value="NetCat">
            <options>
                <option name="port" value="10000" />
                <option name="duration" value="600" />
                <option name="addr" type="recipe_eval" value="['machines'][2]['netconfig'][3]['addresses'][0]" />
                <option name="stream" value="udp" />
            </options>
        </command>
        <command type="kill" machine_id="2" value="2" />

<!-- TEST:3  start iperf tests ... -->

        <command machine_id="1" type="test" value="Iperf" bg_id="31">
            <options>
                <option name="install_dir" value="/opt" />
                <option name="role" value="server" />
                <option name="bind" value="192.168.100.2" />
            </options>
        </command>

        <command type="exec" value="sleep 5" />

        <command machine_id="2" type="test" value="Iperf">
            <options>
                <option name="install_dir" value="/opt" />
                <option name="role" value="client" />
                <option name="iperf_server" value="192.168.100.2" />
                <option name="duration" value="600" />
            </options>
        </command>

        <command type="kill" machine_id="1" value="31" />


    </command_sequence>

</nettestrecipe>
