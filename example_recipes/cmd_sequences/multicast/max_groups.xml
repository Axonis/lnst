<!-- Offline maximum number of groups test -->
<!-- Requires: 1 host with one interface -->

<command_sequence>
    <!-- With a specific interface -->
    <command type="test" value="Multicast" machine_id="1" timeout="30">
        <options>
            <option name="setup" value="max_groups" />
            <option name="interface" value="{$host1if1}" />
            <option name="condition" value="max_groups > 0" />
        </options>
    </command>

    <!-- Change default max_memberhsips -->
    <command type="exec" value="echo '5' > /proc/sys/net/ipv4/igmp_max_memberships" machine_id="1" />
    <command type="test" value="Multicast" machine_id="1" timeout="30">
        <options>
            <option name="setup" value="max_groups" />
            <option type="recipe_eval" name="interface" value="['machines'][1]['netconfig'][1]['addresses'][0]" />
            <option name="condition" value="max_groups == 5" />
        </options>
    </command>
    <command type="exec" value="echo '20' > /proc/sys/net/ipv4/igmp_max_memberships" machine_id="1" />

</command_sequence>
