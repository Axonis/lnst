<nettestrecipe>
  <machines>
    <machine id="1">
      <netmachineconfig source="machine_configs/config-f14peanut.xml"/>
      <netconfig>
        <netdevice id="1" type="eth" phys_id="1"/>
        <netdevice id="2" type="eth" phys_id="2"/>
        <netdevice id="3" type="bridge">
	  <slaves>
            <slave id="1"/>
          </slaves>
          <addresses>
            <address value="192.168.101.1/24"/>
          </addresses>
        </netdevice>
      </netconfig>
    </machine>
    <machine id="2">
      <netmachineconfig source="machine_configs/config-junkbox.xml"/>
      <netconfig>
        <netdevice id="1" type="eth" phys_id="1">
          <addresses>
            <address value="192.168.101.2/24"/>
          </addresses>
	</netdevice>
        <netdevice id="2" type="eth" phys_id="2">
          <addresses>
            <address value="192.168.101.2/24"/>
          </addresses>
	</netdevice>
      </netconfig>
    </machine>
  </machines>
  <command_sequence>
    <command type="exec" value="sleep 4"/>
    <command machine_id="1" type="test" value="PktCounter" bg_id="1">
      <options>
        <option name="input_netdev_name" type="recipe_eval" value="['machines'][1]['netconfig'][3]['name']"/>
        <option name="proto" value="udp"/>
        <option name="dport" value="9"/>
      </options>
    </command>
    <command machine_id="2" type="test" value="PktgenTx" timeout="40">
      <options>
        <option name="addr" type="recipe_eval" value="['machines'][1]['netconfig'][3]['addresses'][0]"/>
        <option name="hwaddr" type="recipe_eval" value="['machines'][1]['netconfig'][1]['hwaddr']"/>
        <option name="netdev_name" type="recipe_eval" value="['machines'][2]['netconfig'][1]['name']"/>
        <option name="netdev_name" type="recipe_eval" value="['machines'][2]['netconfig'][2]['name']"/>
      </options>
    </command>
    <command machine_id="1" type="intr" value="1"/>
  </command_sequence>
</nettestrecipe>
